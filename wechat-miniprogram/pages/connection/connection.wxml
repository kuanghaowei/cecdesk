<!--pages/connection/connection.wxml-->
<view class="container">
  
  <!-- ç½‘ç»œçŠ¶æ€æ  -->
  <view class="network-status {{networkStatus.isConnected ? 'connected' : 'disconnected'}}">
    <view class="network-info">
      <text class="network-type">{{getNetworkTypeText(networkStatus.type)}}</text>
      <text class="signal-icon" wx:if="{{networkStatus.isConnected}}">{{getSignalIcon(networkStatus.signal)}}</text>
    </view>
    <text class="network-text">
      {{networkStatus.isConnected ? 'ç½‘ç»œæ­£å¸¸' : 'ç½‘ç»œå¼‚å¸¸'}}
    </text>
  </view>

  <!-- è¿æ¥çŠ¶æ€åŒºåŸŸ -->
  <view class="connection-status">
    <view class="status-indicator {{connectionStatus}}">
      <view class="status-icon">
        <text wx:if="{{connectionStatus === 'disconnected'}}">ğŸ”´</text>
        <text wx:elif="{{connectionStatus === 'connecting'}}">ğŸŸ¡</text>
        <text wx:elif="{{connectionStatus === 'connected'}}">ğŸŸ¢</text>
        <text wx:else>âŒ</text>
      </view>
      <view class="status-text">
        <text wx:if="{{connectionStatus === 'disconnected'}}">æœªè¿æ¥</text>
        <text wx:elif="{{connectionStatus === 'connecting'}}">è¿æ¥ä¸­...</text>
        <text wx:elif="{{connectionStatus === 'connected'}}">å·²è¿æ¥</text>
        <text wx:else>è¿æ¥é”™è¯¯</text>
      </view>
    </view>
    
    <!-- è¿æ¥ä¿¡æ¯ -->
    <view class="connection-info" wx:if="{{connectionStatus === 'connected'}}">
      <view class="info-item">
        <text class="info-label">è¿œç¨‹è®¾å¤‡:</text>
        <text class="info-value">{{connectionInfo.remoteId}}</text>
      </view>
      <view class="info-item">
        <text class="info-label">è¿æ¥åœ°å€:</text>
        <text class="info-value">{{connectionInfo.remoteAddress}}</text>
      </view>
      <view class="info-item">
        <text class="info-label">è¿æ¥æ—¶é•¿:</text>
        <text class="info-value">{{formatConnectionTime(connectionInfo.connectionTime)}}</text>
      </view>
    </view>
  </view>

  <!-- è¿æ¥è¡¨å• -->
  <view class="connection-form" wx:if="{{connectionStatus !== 'connected'}}">
    <view class="form-section">
      <view class="form-title">è¿æ¥è¿œç¨‹è®¾å¤‡</view>
      
      <view class="input-group">
        <view class="input-label">è®¾å¤‡ID</view>
        <input class="input-field" 
               placeholder="è¯·è¾“å…¥è¿œç¨‹è®¾å¤‡ID" 
               value="{{inputRemoteId}}"
               bindinput="onRemoteIdInput"
               maxlength="32" />
      </view>
      
      <view class="input-group">
        <view class="input-label">è¿æ¥å¯†ç  (å¯é€‰)</view>
        <input class="input-field" 
               placeholder="è¯·è¾“å…¥è¿æ¥å¯†ç " 
               value="{{inputPassword}}"
               bindinput="onPasswordInput"
               password="true"
               maxlength="16" />
      </view>
      
      <!-- è¿æ¥é€‰é¡¹ -->
      <view class="connection-options">
        <view class="option-item">
          <text class="option-label">è‡ªåŠ¨é‡è¿</text>
          <switch checked="{{connectionOptions.autoReconnect}}" 
                 bindchange="onAutoReconnectChange" />
        </view>
        
        <view class="option-item">
          <text class="option-label">ç”»è´¨</text>
          <picker mode="selector" range="{{['æµç•…', 'æ ‡å‡†', 'é«˜æ¸…']}}" 
                 value="{{connectionOptions.quality === 'low' ? 0 : connectionOptions.quality === 'medium' ? 1 : 2}}"
                 bindchange="onQualityChange">
            <view class="picker-text">{{getQualityText(connectionOptions.quality)}}</view>
          </picker>
        </view>
        
        <view class="option-item">
          <text class="option-label">å¯ç”¨éŸ³é¢‘</text>
          <switch checked="{{connectionOptions.enableAudio}}" 
                 bindchange="onEnableAudioChange" />
        </view>
      </view>
      
      <!-- è¿æ¥æŒ‰é’® -->
      <view class="button-group">
        <button class="connect-btn {{connectionStatus === 'connecting' ? 'disabled' : ''}}" 
                bindtap="startConnection" 
                disabled="{{connectionStatus === 'connecting'}}">
          {{connectionStatus === 'connecting' ? 'è¿æ¥ä¸­...' : 'å¼€å§‹è¿æ¥'}}
        </button>
        
        <button class="scan-btn" bindtap="scanQRCode">
          æ‰«ç è¿æ¥
        </button>
      </view>
    </view>
  </view>

  <!-- å·²è¿æ¥çŠ¶æ€çš„æ“ä½œ -->
  <view class="connected-actions" wx:if="{{connectionStatus === 'connected'}}">
    <button class="action-btn desktop-btn" bindtap="goToDesktop">
      è¿›å…¥è¿œç¨‹æ¡Œé¢
    </button>
    
    <button class="action-btn file-btn" bindtap="goToFileTransfer">
      æ–‡ä»¶ä¼ è¾“
    </button>
    
    <button class="action-btn disconnect-btn" bindtap="disconnect">
      æ–­å¼€è¿æ¥
    </button>
  </view>

  <!-- è¿æ¥å†å² -->
  <view class="history-section" wx:if="{{connectionHistory.length > 0}}">
    <view class="history-header">
      <text class="history-title">è¿æ¥å†å²</text>
      <text class="clear-history" bindtap="clearHistory">æ¸…ç©º</text>
    </view>
    
    <view class="history-list">
      <view class="history-item" wx:for="{{connectionHistory}}" wx:key="remoteId">
        <view class="history-info" bindtap="connectFromHistory" data-remote-id="{{item.remoteId}}">
          <view class="history-id">{{item.remoteId}}</view>
          <view class="history-time">{{item.date}}</view>
        </view>
        <view class="history-actions">
          <text class="delete-btn" bindtap="deleteHistoryItem" data-index="{{index}}">åˆ é™¤</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{connectionHistory.length === 0 && connectionStatus === 'disconnected'}}">
    <view class="empty-icon">ğŸ–¥ï¸</view>
    <text class="empty-text">æš‚æ— è¿æ¥å†å²</text>
    <text class="empty-hint">è¾“å…¥è®¾å¤‡IDæˆ–æ‰«ç å¼€å§‹è¿æ¥</text>
  </view>

</view>