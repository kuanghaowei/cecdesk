<!--pages/file-transfer/file-transfer.wxml-->
<view class="container">
  <!-- æ ‡ç­¾é¡µå¯¼èˆª -->
  <view class="tab-bar">
    <view class="tab-item {{activeTab === 0 ? 'active' : ''}}" 
          bindtap="switchTab" data-index="0">
      <text>å‘é€æ–‡ä»¶</text>
    </view>
    <view class="tab-item {{activeTab === 1 ? 'active' : ''}}" 
          bindtap="switchTab" data-index="1">
      <text>æ¥æ”¶æ–‡ä»¶</text>
    </view>
    <view class="tab-item {{activeTab === 2 ? 'active' : ''}}" 
          bindtap="switchTab" data-index="2">
      <text>ä¼ è¾“å†å²</text>
    </view>
  </view>

  <!-- å‘é€æ–‡ä»¶é¡µé¢ -->
  <view class="tab-content" wx:if="{{activeTab === 0}}">
    <view class="send-section">
      <!-- æ·»åŠ æ–‡ä»¶æŒ‰é’® -->
      <view class="add-files-btn" bindtap="chooseFilesToSend">
        <view class="add-icon">+</view>
        <text>é€‰æ‹©æ–‡ä»¶</text>
      </view>

      <!-- æ–‡ä»¶åˆ—è¡¨ -->
      <view class="file-list" wx:if="{{sendFiles.length > 0}}">
        <view class="file-item" wx:for="{{sendFiles}}" wx:key="id">
          <view class="file-info">
            <view class="file-icon">{{getFileIcon(item.type)}}</view>
            <view class="file-details">
              <text class="file-name">{{item.name}}</text>
              <text class="file-size">{{formatFileSize(item.size)}}</text>
              <text class="file-status">{{getStatusText(item.status)}}</text>
            </view>
          </view>
          
          <!-- è¿›åº¦æ¡ -->
          <view class="progress-bar" wx:if="{{item.status === 'sending'}}">
            <view class="progress-fill" style="width: {{item.progress}}%"></view>
          </view>
          
          <!-- æ“ä½œæŒ‰é’® -->
          <view class="file-actions">
            <view class="remove-btn" bindtap="removeSendFile" data-file-id="{{item.id}}"
                  wx:if="{{item.status === 'pending'}}">
              <text>ç§»é™¤</text>
            </view>
          </view>
        </view>
      </view>

      <!-- å‘é€æŒ‰é’® -->
      <view class="send-btn-container" wx:if="{{sendFiles.length > 0}}">
        <button class="send-btn {{isTransferring ? 'disabled' : ''}}" 
                bindtap="startSendFiles" disabled="{{isTransferring}}">
          {{isTransferring ? 'å‘é€ä¸­...' : 'å‘é€æ–‡ä»¶'}}
        </button>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-state" wx:if="{{sendFiles.length === 0}}">
        <view class="empty-icon">ğŸ“</view>
        <text class="empty-text">æš‚æ— å¾…å‘é€æ–‡ä»¶</text>
        <text class="empty-hint">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®é€‰æ‹©æ–‡ä»¶</text>
      </view>
    </view>
  </view>

  <!-- æ¥æ”¶æ–‡ä»¶é¡µé¢ -->
  <view class="tab-content" wx:if="{{activeTab === 1}}">
    <view class="receive-section">
      <!-- è¯·æ±‚æ–‡ä»¶æŒ‰é’® -->
      <view class="request-btn-container">
        <button class="request-btn" bindtap="requestReceiveFile">
          è¯·æ±‚æ–‡ä»¶
        </button>
      </view>

      <!-- æ¥æ”¶æ–‡ä»¶åˆ—è¡¨ -->
      <view class="file-list" wx:if="{{receiveFiles.length > 0}}">
        <view class="file-item" wx:for="{{receiveFiles}}" wx:key="id">
          <view class="file-info">
            <view class="file-icon">{{getFileIcon(item.type)}}</view>
            <view class="file-details">
              <text class="file-name">{{item.name}}</text>
              <text class="file-size">{{formatFileSize(item.size)}}</text>
              <text class="file-status">{{getStatusText(item.status)}}</text>
            </view>
          </view>
          
          <!-- è¿›åº¦æ¡ -->
          <view class="progress-bar" wx:if="{{item.status === 'receiving'}}">
            <view class="progress-fill" style="width: {{item.progress}}%"></view>
          </view>
          
          <!-- æ“ä½œæŒ‰é’® -->
          <view class="file-actions">
            <view class="save-btn" bindtap="saveReceivedFile" data-file-id="{{item.id}}"
                  wx:if="{{item.status === 'completed'}}">
              <text>ä¿å­˜</text>
            </view>
            <view class="delete-btn" bindtap="deleteReceivedFile" data-file-id="{{item.id}}">
              <text>åˆ é™¤</text>
            </view>
          </view>
        </view>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-state" wx:if="{{receiveFiles.length === 0}}">
        <view class="empty-icon">ğŸ“¥</view>
        <text class="empty-text">æš‚æ— æ¥æ”¶æ–‡ä»¶</text>
        <text class="empty-hint">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®è¯·æ±‚æ–‡ä»¶</text>
      </view>
    </view>
  </view>

  <!-- ä¼ è¾“å†å²é¡µé¢ -->
  <view class="tab-content" wx:if="{{activeTab === 2}}">
    <view class="history-section">
      <!-- æ¸…ç©ºå†å²æŒ‰é’® -->
      <view class="clear-btn-container" wx:if="{{transferHistory.length > 0}}">
        <button class="clear-btn" bindtap="clearTransferHistory">
          æ¸…ç©ºå†å²
        </button>
      </view>

      <!-- å†å²è®°å½•åˆ—è¡¨ -->
      <view class="history-list" wx:if="{{transferHistory.length > 0}}">
        <view class="history-item" wx:for="{{transferHistory}}" wx:key="id">
          <view class="history-info">
            <view class="history-icon">
              <text wx:if="{{item.direction === 'send'}}">ğŸ“¤</text>
              <text wx:else>ğŸ“¥</text>
            </view>
            <view class="history-details">
              <text class="history-name">{{item.fileName}}</text>
              <text class="history-size">{{formatFileSize(item.fileSize)}}</text>
              <text class="history-time">{{item.date}}</text>
            </view>
          </view>
          <view class="history-status">
            <text class="status-text {{item.status === 'completed' ? 'success' : 'failed'}}">
              {{item.status === 'completed' ? 'æˆåŠŸ' : 'å¤±è´¥'}}
            </text>
          </view>
        </view>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-state" wx:if="{{transferHistory.length === 0}}">
        <view class="empty-icon">ğŸ“‹</view>
        <text class="empty-text">æš‚æ— ä¼ è¾“å†å²</text>
        <text class="empty-hint">å®Œæˆæ–‡ä»¶ä¼ è¾“åä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ</text>
      </view>
    </view>
  </view>
</view>