<!--pages/remote-desktop/remote-desktop.wxml-->
<view class="remote-desktop-container">
  <!-- è¿æ¥çŠ¶æ€é®ç½© -->
  <view class="connecting-overlay" wx:if="{{isConnecting}}">
    <view class="connecting-content">
      <view class="loading-spinner"></view>
      <text class="connecting-text">æ­£åœ¨è¿æ¥åˆ° {{deviceId}}...</text>
      <text class="connecting-tip">è¯·ç¨å€™ï¼Œæ­£åœ¨å»ºç«‹å®‰å…¨è¿æ¥</text>
    </view>
  </view>

  <!-- è¿œç¨‹æ¡Œé¢æ˜¾ç¤ºåŒºåŸŸ -->
  <view class="desktop-display {{isFullscreen ? 'fullscreen' : ''}}" bindtap="toggleControls">
    <!-- ä½¿ç”¨ Canvas æ˜¾ç¤ºè¿œç¨‹æ¡Œé¢ -->
    <canvas 
      canvas-id="{{canvasId}}" 
      class="desktop-canvas"
      bindtouchstart="onTouchStart"
      bindtouchmove="onTouchMove"
      bindtouchend="onTouchEnd"
      bindlongpress="onLongPress"
      disable-scroll="{{true}}"
    ></canvas>
    
    <!-- å®æ—¶æ’­æ”¾å™¨ (å¤‡ç”¨æ–¹æ¡ˆ) -->
    <live-player 
      id="livePlayer"
      class="live-player {{isConnected ? 'show' : 'hide'}}"
      src=""
      mode="RTC"
      autoplay="{{true}}"
      muted="{{false}}"
      orientation="vertical"
      object-fit="contain"
      background-mute="{{false}}"
      min-cache="1"
      max-cache="3"
      bindstatechange="onLivePlayerStateChange"
      bindnetstatus="onLivePlayerNetStatus"
    ></live-player>

    <!-- è¿æ¥çŠ¶æ€æŒ‡ç¤ºå™¨ -->
    <view class="connection-status {{showControls ? 'show' : 'hide'}}" wx:if="{{isConnected}}">
      <view class="status-dot {{connectionQuality}}"></view>
      <text class="status-text">{{connectionQuality === 'excellent' ? 'ä¼˜ç§€' : connectionQuality === 'good' ? 'è‰¯å¥½' : connectionQuality === 'fair' ? 'ä¸€èˆ¬' : 'è¾ƒå·®'}}</text>
    </view>

    <!-- ç½‘ç»œç»Ÿè®¡ä¿¡æ¯ -->
    <view class="network-stats {{showControls ? 'show' : 'hide'}}" wx:if="{{isConnected}}">
      <text class="stats-text">{{networkStats.rtt}}ms â€¢ {{networkStats.fps}}fps â€¢ {{networkStats.resolution}}</text>
    </view>

    <!-- æœªè¿æ¥çŠ¶æ€ -->
    <view class="disconnected-state" wx:if="{{!isConnected && !isConnecting}}">
      <view class="disconnected-icon">ğŸ“±</view>
      <text class="disconnected-title">è¿æ¥å·²æ–­å¼€</text>
      <text class="disconnected-subtitle">ç‚¹å‡»é‡æ–°è¿æ¥æŒ‰é’®æ¢å¤è¿æ¥</text>
      <button class="btn-reconnect" bindtap="connectToRemoteDesktop">é‡æ–°è¿æ¥</button>
    </view>
  </view>

  <!-- æ§åˆ¶é¢æ¿ -->
  <view class="control-panel {{showControls && isConnected ? 'show' : 'hide'}}">
    <view class="control-buttons">
      <!-- è™šæ‹Ÿé”®ç›˜ -->
      <view class="control-btn" bindtap="showVirtualKeyboard">
        <view class="btn-icon">âŒ¨ï¸</view>
        <text class="btn-text">é”®ç›˜</text>
      </view>

      <!-- æˆªå›¾ -->
      <view class="control-btn" bindtap="takeScreenshot">
        <view class="btn-icon">ğŸ“·</view>
        <text class="btn-text">æˆªå›¾</text>
      </view>

      <!-- å…¨å± -->
      <view class="control-btn" bindtap="toggleFullscreen">
        <view class="btn-icon">{{isFullscreen ? 'ğŸ”²' : 'â›¶'}}</view>
        <text class="btn-text">{{isFullscreen ? 'é€€å‡º' : 'å…¨å±'}}</text>
      </view>

      <!-- è®¾ç½® -->
      <view class="control-btn" bindtap="showSettings">
        <view class="btn-icon">âš™ï¸</view>
        <text class="btn-text">è®¾ç½®</text>
      </view>

      <!-- æ–­å¼€è¿æ¥ -->
      <view class="control-btn disconnect" bindtap="confirmDisconnect">
        <view class="btn-icon">âŒ</view>
        <text class="btn-text">æ–­å¼€</text>
      </view>
    </view>
  </view>

  <!-- æ“ä½œæç¤º -->
  <view class="operation-hint {{showControls ? 'hide' : 'show'}}" wx:if="{{isConnected}}">
    <text class="hint-text">ç‚¹å‡»å±å¹•æ˜¾ç¤ºæ§åˆ¶é¢æ¿</text>
  </view>
</view>